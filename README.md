# Тестовое задание: Анализ лайков во ВКонтакте

## Адрес страницы
Анализируемая страница: (https://vk.com/mnv_1997)

Примечание: страница друга(данные взяты с его согласия)

Таблица в формате CSV приложена в файле: [data.csv](data.csv)

---

## Сбор данных

Для сбора данных использовался официальный VK API. Собраны поля:
- ID поста
- Дата публикации
- Количество лайков
- Текст поста

День недели рассчитан программно на основе даты (`1 = понедельник, ..., 7 = воскресенье`).

Основной код приложен в файле: [main.py](main.py)

---

## SQL - запросы 

Работа проводилась с помощью СУБД PostgreSQL в программе pgAdmin 4

### 1. Вывод количества лайков в зависимости от времени публикации

**Запрос:**
```sql
SELECT
    CASE  --Функция CASE проверяет истинность набора условий и возвращает результат в зависимости от условия
        -- EXTRACT извлекает из даты и времени значение часа
        WHEN EXTRACT(HOUR FROM дата_поста) >= 0 AND EXTRACT(HOUR FROM дата_поста) < 8 THEN '00:00–08:00'
        WHEN EXTRACT(HOUR FROM дата_поста) >= 8 AND EXTRACT(HOUR FROM дата_поста) < 12 THEN '08:00–12:00'
        WHEN EXTRACT(HOUR FROM дата_поста) >= 12 AND EXTRACT(HOUR FROM дата_поста) < 18 THEN '12:00–18:00'
        ELSE '18:00–00:00'
    END AS Временной_период,
    COUNT(*) AS Количество_постов,  -- Количество постов за промежуток времени
    SUM(количество_лайков) AS Общая_сумма_лайков, -- Сумма лайков за промежуток времени
    ROUND(AVG(количество_лайков), 2) AS Среднее_количество -- Округлённое среднее значение лайков за промежуток времени
FROM posts
GROUP BY
    CASE
        WHEN EXTRACT(HOUR FROM дата_поста) >= 0 AND EXTRACT(HOUR FROM дата_поста) < 8 THEN '00:00–08:00'
        WHEN EXTRACT(HOUR FROM дата_поста) >= 8 AND EXTRACT(HOUR FROM дата_поста) < 12 THEN '08:00–12:00'
        WHEN EXTRACT(HOUR FROM дата_поста) >= 12 AND EXTRACT(HOUR FROM дата_поста) < 18 THEN '12:00–18:00'
        ELSE '18:00–00:00'
    END
ORDER BY
    MIN(EXTRACT(HOUR FROM дата_поста));
```

**Результат запроса:**

<img width="813" height="182" alt="image" src="https://github.com/user-attachments/assets/8b4fdb7c-1e94-45d2-8999-345217822cbb" />


В данном случае видно, что большее количество лайков в общем оставляется под постами, опубликованными после 18:00, то есть вечером, после рабочего дня.

Однако, если оценивать эффективность публикаций по среднему количеству лайков на один пост, то лидером является период 08:00–12:00 с показателем 20.82 лайка на пост. Это указывает на то, что посты, опубликованные утром, несмотря на меньшее общее количество, в среднем получают больше лайков, чем посты, опубликованные вечером.


### 2. Вывод количества лайков по дням недели

**Запрос:**
```sql
SELECT
    день_недели,
    COUNT(*) AS Количество_постов,
    SUM(количество_лайков) AS Общая_сумма_лайков,
    ROUND(AVG(количество_лайков), 2) AS Среднее_количество
FROM posts
GROUP BY день_недели
ORDER BY день_недели;
```

**Результат запроса:**

<img width="768" height="276" alt="image" src="https://github.com/user-attachments/assets/900fe961-325e-4e0c-8c63-a929a3710bed" />

Анализ данных по дням недели (где 1 — понедельник, 7 — воскресенье) показывает, что воскресенье (день 7) является самым активным днем для получения лайков.

В воскресенте самое высокое среднее количество лайков - 20.70, и самая большая общая сумма лайков - 973. В этот день аудитория наиболее активна во взаимодействии с постами.
Также стоит отметить, что подъём активности аудитории начинается ещё в пятницу, что связано с наступлением выходных дней. 

Среда, напротив, является наименее эффективным днем недели для публикации, если цель — получить максимальное количество лайков.


### 3. Объединённые данные

**Запрос:**
```sql
SELECT
    день_недели,
    CASE
        WHEN EXTRACT(HOUR FROM дата_поста) >= 0 AND EXTRACT(HOUR FROM дата_поста) < 8 THEN '00:00–08:00'
        WHEN EXTRACT(HOUR FROM дата_поста) >= 8 AND EXTRACT(HOUR FROM дата_поста) < 12 THEN '08:00–12:00'
        WHEN EXTRACT(HOUR FROM дата_поста) >= 12 AND EXTRACT(HOUR FROM дата_поста) < 18 THEN '12:00–18:00'
        ELSE '18:00–00:00'
    END AS Временной_период,
    COUNT(*) AS Количество_постов,
    SUM(количество_лайков) AS Общая_сумма_лайков,
    ROUND(AVG(количество_лайков), 2) AS Среднее_количество
FROM posts
GROUP BY
    день_недели,
    CASE
        WHEN EXTRACT(HOUR FROM дата_поста) >= 0 AND EXTRACT(HOUR FROM дата_поста) < 8 THEN '00:00–08:00'
        WHEN EXTRACT(HOUR FROM дата_поста) >= 8 AND EXTRACT(HOUR FROM дата_поста) < 12 THEN '08:00–12:00'
        WHEN EXTRACT(HOUR FROM дата_поста) >= 12 AND EXTRACT(HOUR FROM дата_поста) < 18 THEN '12:00–18:00'
        ELSE '18:00–00:00'
    END
ORDER BY
    день_недели, MIN(EXTRACT(HOUR FROM дата_поста));
```

Результат запроса приложен в файле: [request-3.csv](request-3.csv)

#### 1. Влияние времени суток

- Самый высокий средний уровень вовлечённости (среднее количество лайков на пост) наблюдается в период 08:00–12:00.
- Особенно выделяется понедельник: 30.33 лайка в среднем.
- Также высокие значения: пятница (26.40) и воскресенье (22.63) в это время.
- Вечерний период (18:00–00:00) характеризуется наибольшим общим числом лайков, но среднее значение ниже, чем утреннее .
#### 2. Влияние дня недели
Понедельник и пятница — дни с наивысшей эффективностью постов по среднему количеству лайков:
- Понедельник: 30.33 (08:00–12:00)
- Пятница: 26.40 (00:00–08:00)

Воскресенье — лидер по общему количеству лайков, благодаря большому числу публикаций (47 постов), но среднее значение (~20.7) уступает понедельнику.

Среда и четверг — наименее активные дни как по общему, так и по среднему количеству лайков.
#### 3. Оптимальное сочетание
Лучшее время для публикации — утро (08:00–12:00) в понедельник, где достигается максимальная вовлечённость на пост, скорее всего, связанное с привычкой людей проверять новости с утра перед новой рабочей неделей.

Наибольший охват аудитории — вечером (18:00–00:00) в воскресенье, если цель — максимизировать общее число лайков.

### 4. Зависимость количества лайков от года

**Запрос:**
```sql
SELECT
    EXTRACT (YEAR FROM дата_поста) AS Год, -- Извлекает из даты и времени значение года
	COUNT(*) AS Количество_постов,
    SUM(количество_лайков) AS Общая_сумма_лайков,
    ROUND(AVG(количество_лайков), 2) AS Среднее_количество
FROM posts
GROUP BY Год
ORDER BY Год;
```

**Результат запроса:**

<img width="723" height="425" alt="image" src="https://github.com/user-attachments/assets/12753bda-f694-431b-acd9-7f963616e7de" />

Для максимизации вовлеченности (общего числа лайков) важно постоянно публиковать контент, так как данные показывают, что чем больше постов за год, тем выше общая сумма лайков.

### 5. Влияние промежутка времени между публикациями

**Запрос:**
```sql
SELECT
    id_поста,
    дата_поста,
    количество_лайков,
    -- Функция LAG() возвращает предыдущую запись относительно данной
    LAG(дата_поста) OVER (ORDER BY дата_поста) AS дата_предыдущего_поста, 
    дата_поста - LAG(дата_поста) OVER (ORDER BY дата_поста) AS интервал_между_постами
FROM posts
ORDER BY дата_поста;
```

В данном случае нет какой-то корреляции между популярностью поста и временем, прошедшим с прошлой публикации.

Например:

<img width="1043" height="180" alt="image" src="https://github.com/user-attachments/assets/8209b9b9-b375-4db7-a790-e2a64eb8890f" />

Пост 1109 собрал всего 26 лайков, хотя и был опубликован спустя 96 дней с прошлого поста.

А вот как раз пост 1105 хоть и был опубликован спустя всего менее 2-х часов с прошлого поста, собрал больше - 31 лайк.


Ещё пример:

<img width="1044" height="180" alt="image" src="https://github.com/user-attachments/assets/40328155-4a0a-46c5-86b6-7e79f82c9060" />

Здесь уже обратная ситуация - пост 1236 собрал 54 лайка будучи опубликованным спустя 13 дней.

А вот пост 1237, появившийся спустя ~17 часов собрал почти в 2 раза меньше - 28

Пост 1239, опубликованный спустя всего лишь 3 часа ещё меньше - всего 1


Так что на количество лайков в большей степени влияет время публикации, а также может влиять контекст или значение поста.

---

# Визуализация

Для более полной картины было построено несколько графиков.

Они приложены в файле [graphs.ipynb](graphs.ipynb)


